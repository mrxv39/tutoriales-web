<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutoriales Web</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Bienvenido a Tutoriales Web</h1>
    <p class="tagline">Usa las herramientas y sé libre</p>
    <p class="header-description">Aprende a dominar las herramientas que hacen tu trabajo más fácil.</p>
    <nav>
      <a href="#" id="profile-link" class="link-nav">Cargando...</a>
    </nav>
  </header>
  
  <main>
    <div id="onboarding-banner" class="banner hidden">
      <p>
        <strong>¡Personaliza tu experiencia!</strong> 
        <a href="onboarding.html">Completa tu cuestionario</a> para tener tu plan de aprendizaje.
      </p>
    </div>
    
    <section>
      <h2>Categorías</h2>
      <div class="categories">
        <span class="category-tag">Productividad</span>
        <span class="category-tag">Herramientas</span>
        <span class="category-tag">Sistema</span>
      </div>
    </section>
    
    <section>
      <h2>Tutoriales Disponibles</h2>
      <ul class="tutorial-list" id="tutorial-list">
        <li>Cargando tutoriales...</li>
      </ul>
    </section>
  </main>
  
  <footer>
    <p>&copy; 2026 Tutoriales Web</p>
  </footer>

  <script>
    // Update profile link based on auth state
    const profileLink = document.getElementById('profile-link');
    
    fetch('/api/auth/me')
      .then(res => res.json())
      .then(authData => {
        if (authData.loggedIn) {
          profileLink.textContent = 'Mi perfil';
          profileLink.href = 'perfil.html';
          
          // Load profile to check for onboarding
          return fetch('/api/profile');
        } else {
          profileLink.textContent = 'Crear perfil';
          profileLink.href = 'registro.html';
          return null;
        }
      })
      .then(profileRes => {
        if (profileRes) {
          return profileRes.json();
        }
        return null;
      })
      .then(profileData => {
        // Show onboarding banner if logged in but no onboarding
        if (profileData) {
          const profile = profileData.profile || {};
          if (!profile.onboarding) {
            document.getElementById('onboarding-banner').classList.remove('hidden');
          }
        }
      })
      .catch(err => {
        console.error('Auth check failed:', err);
        profileLink.textContent = 'Crear perfil';
        profileLink.href = 'registro.html';
      });

    // Fetch and render tutorials from JSON manifest
    fetch('/tutoriales/index.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('No se pudo cargar el listado de tutoriales');
        }
        return response.json();
      })
      .then(tutorials => {
        const listElement = document.getElementById('tutorial-list');
        
        if (tutorials.length === 0) {
          listElement.innerHTML = '<li>No hay tutoriales disponibles en este momento.</li>';
          return;
        }
        
        listElement.innerHTML = tutorials.map(tutorial => `
          <li>
            <a href="tutorial.html?slug=${tutorial.slug}">
              <strong>${tutorial.title}</strong>
            </a>
            <div class="tutorial-tags">
              ${tutorial.categories.map(cat => `<span class="tag">${cat}</span>`).join('')}
              ${tutorial.dev_time ? `<span class="dev-time-tag">Tiempo de desarrollo: ${tutorial.dev_time}</span>` : ''}
            </div>
            <p>${tutorial.description}</p>
          </li>
        `).join('');
      })
      .catch(error => {
        const listElement = document.getElementById('tutorial-list');
        listElement.innerHTML = '<li>Error al cargar los tutoriales. Por favor, intenta más tarde.</li>';
        console.error('Error loading tutorials:', error);
      });
  </script>
</body>
</html>
